function a(e){return e=p(e),e=u(e),m(e)}function p(e){const t=/(^|[^\\]);.*/g;return e.replace(t,function(r,n){return n||""})}function u(e){const t=[],r=/\([\s\S]*?\)/gim;let n=r.exec(e);for(;n!==null;){const i=n[0].replace(/\s+/gm," ");t.push({match:n,replacement:i}),n=r.exec(e)}const s=e.split("");for(const i of t){const{match:o,replacement:c}=i;s.splice(o.index,o[0].length,c)}return s.join("").replace(/\(|\)/gim," ")}function m(e){const t={},r=e.split(`
`);for(const n of r){if(!n||!n.trim())continue;const s=n.toUpperCase();/\s+TXT\s+/.test(s)?(t.txt=t.txt||[],t.txt.push(R(n))):s.indexOf("$ORIGIN")===0?t.$origin=n.split(/\s+/g)[1]:s.indexOf("$TTL")===0?t.$ttl=parseInt(n.split(/\s+/g)[1],10):/\s+SOA\s+/.test(s)?t.soa=g(n):/\s+NS\s+/.test(s)?(t.ns=t.ns||[],t.ns.push(h(n))):/\s+A\s+/.test(s)?(t.a=t.a||[],t.a.push(T(n,t.a))):/\s+AAAA\s+/.test(s)?(t.aaaa=t.aaaa||[],t.aaaa.push(I(n))):/\s+CNAME\s+/.test(s)?(t.cname=t.cname||[],t.cname.push(N(n))):/\s+MX\s+/.test(s)?(t.mx=t.mx||[],t.mx.push(A(n))):/\s+PTR\s+/.test(s)?(t.ptr=t.ptr||[],t.ptr.push($(n,t.ptr,t.$origin))):/\s+SRV\s+/.test(s)?(t.srv=t.srv||[],t.srv.push(d(n))):/\s+SPF\s+/.test(s)?(t.spf=t.spf||[],t.spf.push(x(n))):/\s+URI\s+/.test(s)&&(t.uri=t.uri||[],t.uri.push(S(n)))}return t}function g(e){const t={},r=e.trim().split(/\s+/g),n=r.length;return t.name=r[0],t.minimum=parseInt(r[n-1],10),t.expire=parseInt(r[n-2],10),t.retry=parseInt(r[n-3],10),t.refresh=parseInt(r[n-4],10),t.serial=parseInt(r[n-5],10),t.rname=r[n-6],t.mname=r[n-7],isNaN(r[1])||(t.ttl=parseInt(r[1],10)),t}function h(e){const t=e.trim().split(/\s+/g),r=t.length,n={name:t[0],host:t[r-1]};return isNaN(t[1])||(n.ttl=parseInt(t[1],10)),n}function T(e,t){const r=e.trim().split(/\s+/g),n=e.trim().toUpperCase().split(/\s+/g),s=r.length,i={name:r[0],ip:r[s-1]};return n.lastIndexOf("A")===0&&(t.length?i.name=t[t.length-1].name:i.name="@"),isNaN(r[1])||(i.ttl=parseInt(r[1],10)),i}function I(e){const t=e.trim().split(/\s+/g),r=t.length,n={name:t[0],ip:t[r-1]};return isNaN(t[1])||(n.ttl=parseInt(t[1],10)),n}function N(e){const t=e.trim().split(/\s+/g),r=t.length,n={name:t[0],alias:t[r-1]};return isNaN(t[1])||(n.ttl=parseInt(t[1],10)),n}function A(e){const t=e.trim().split(/\s+/g),r=t.length,n={name:t[0],preference:parseInt(t[r-2],10),host:t[r-1]};return isNaN(t[1])||(n.ttl=parseInt(t[1],10)),n}function R(e){const t=e.trim().match(/[^\s"']+|"[^"]*"|'[^']*'/g);if(!t)throw new Error("Failure to tokenize TXT record");const r=t.length,n=t.indexOf("TXT");function s(c){return c.indexOf('"')>-1&&(c=c.split('"')[1]),c}let i;r-n-1>1?i=[...t.slice(n+1).map(s)]:i=s(t[r-1]);const o={name:t[0],txt:i};return isNaN(t[1])||(o.ttl=parseInt(t[1],10)),o}function $(e,t,r){const n=e.trim().split(/\s+/g);e.trim().toUpperCase().split(/\s+/g).lastIndexOf("PTR")===0&&t[t.length-1]&&n.unshift(t[t.length-1].name);const i=n.length,o={name:n[0],fullname:`${n[0]}.${r}`,host:n[i-1]};return isNaN(n[1])||(o.ttl=parseInt(n[1],10)),o}function d(e){const t=e.trim().split(/\s+/g),r=t.length,n={name:t[0],target:t[r-1],priority:parseInt(t[r-4],10),weight:parseInt(t[r-3],10),port:parseInt(t[r-2],10)};return isNaN(t[1])||(n.ttl=parseInt(t[1],10)),n}function x(e){const t=e.trim().split(/\s+/g),r={name:t[0],data:""};let n=t.length;for(;n-- >4;)r.data=t[n]+" "+r.data.trim();return isNaN(t[1])||(r.ttl=parseInt(t[1],10)),r}function S(e){const t=e.trim().split(/\s+/g),r=t.length,n={name:t[0],target:t[r-1].replace(/"/g,""),priority:parseInt(t[r-3],10),weight:parseInt(t[r-2],10)};return isNaN(t[1])||(n.ttl=parseInt(t[1],10)),n}function f(){return`{$origin}
{$ttl}

; SOA Record
{name} {ttl}    IN  SOA {mname}{rname}(
{serial} ;serial
{refresh} ;refresh
{retry} ;retry
{expire} ;expire
{minimum} ;minimum ttl
)

; NS Records
{ns}

; MX Records
{mx}

; A Records
{a}

; AAAA Records
{aaaa}

; CNAME Records
{cname}

; PTR Records
{ptr}

; TXT Records
{txt}

; SRV Records
{srv}

; SPF Records
{spf}

; URI Records
{uri}
`}function k(e,t){if(!t.includes("://"))throw new Error("Invalid token file url");const r=t.split("://")[0],n=t.split("://")[1].split("/"),s=n[0],i=`/${n.slice(1).join("/")}`,o={$origin:e,$ttl:3600,uri:[{name:"_http._tcp",priority:10,weight:1,target:`${r}://${s}${i}`}]};return l(o,`{$origin}
{$ttl}
{uri}
`)}function l(e,t=f()){return t=O(e.$origin,t),t=y(e.$ttl,t),t=w(e.soa,t),t=P(e.ns,t),t=X(e.a,t),t=M(e.aaaa,t),t=v(e.cname,t),t=C(e.mx,t),t=E(e.ptr,t),t=U(e.txt,t),t=V(e.srv,t),t=z(e.spf,t),t=D(e.uri,t),t=L(e,t),t.replace(/\n{2,}/gim,`

`)}function O(e,t){let r="";return typeof e!="undefined"&&(r+="$ORIGIN "+e),t.replace("{$origin}",r)}function y(e,t){let r="";return typeof e!="undefined"&&(r+="$TTL "+e),t.replace("{$ttl}",r)}function w(e,t){let r=t;if(typeof e!="undefined"){e.name=e.name||"@",e.ttl=e.ttl||"";for(const n in e){const s=e[n];r=r.replace("{"+n+"}",s+"	")}}return r}function P(e,t){let r="";if(e)for(const n of e)r+=(n.name||"@")+"	",n.ttl&&(r+=n.ttl+"	"),r+="IN	NS	"+n.host+`
`;return t.replace("{ns}",r)}function X(e,t){let r="";if(e)for(const n of e)r+=(n.name||"@")+"	",n.ttl&&(r+=n.ttl+"	"),r+="IN	A	"+n.ip+`
`;return t.replace("{a}",r)}function M(e,t){let r="";if(e)for(const n of e)r+=(n.name||"@")+"	",n.ttl&&(r+=n.ttl+"	"),r+="IN	AAAA	"+n.ip+`
`;return t.replace("{aaaa}",r)}function v(e,t){let r="";if(e)for(const n of e)r+=(n.name||"@")+"	",n.ttl&&(r+=n.ttl+"	"),r+="IN	CNAME	"+n.alias+`
`;return t.replace("{cname}",r)}function C(e,t){let r="";if(e)for(const n of e)r+=(n.name||"@")+"	",n.ttl&&(r+=n.ttl+"	"),r+="IN	MX	"+n.preference+"	"+n.host+`
`;return t.replace("{mx}",r)}function E(e,t){let r="";if(e)for(const n of e)r+=(n.name||"@")+"	",n.ttl&&(r+=n.ttl+"	"),r+="IN	PTR	"+n.host+`
`;return t.replace("{ptr}",r)}function U(e,t){let r="";if(e)for(const n of e){r+=(n.name||"@")+"	",n.ttl&&(r+=n.ttl+"	"),r+="IN	TXT	";const s=n.txt;typeof s=="string"?r+='"'+s+'"':s instanceof Array&&(r+=s.map(function(i){return'"'+i+'"'}).join(" ")),r+=`
`}return t.replace("{txt}",r)}function V(e,t){let r="";if(e)for(const n of e)r+=(n.name||"@")+"	",n.ttl&&(r+=n.ttl+"	"),r+="IN	SRV	"+n.priority+"	",r+=n.weight+"	",r+=n.port+"	",r+=n.target+`
`;return t.replace("{srv}",r)}function z(e,t){let r="";if(e)for(const n of e)r+=(n.name||"@")+"	",n.ttl&&(r+=n.ttl+"	"),r+="IN	SPF	"+n.data+`
`;return t.replace("{spf}",r)}function D(e,t){let r="";if(e)for(const n of e)r+=(n.name||"@")+"	",n.ttl&&(r+=n.ttl+"	"),r+="IN	URI	"+n.priority+"	",r+=n.weight+"	",r+='"'+n.target+`"
`;return t.replace("{uri}",r)}function L(e,t){t=t.replace("{zone}",e.$origin||(e.soa?e.soa.name:!1)||""),t=t.replace("{datetime}",new Date().toISOString());const r=Math.round(Date.now()/1e3);return t.replace("{time}",`${r}`)}export{f as getZoneFileTemplate,k as makeProfileZoneFile,l as makeZoneFile,a as parseZoneFile};
